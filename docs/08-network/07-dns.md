# dns

## DNS 协议了解多少 {#p0-dns-detail}

 DNS 基本概念

DNS（Domain Name System，域名系统）是因特网上用于将主机名转换为 IP 地址的协议。它是一个分布式数据库系统，通过将主机名映射到 IP 地址来实现主机名解析，并使用户能够通过更容易识别的主机名来访问互联网上的资源。

在使用 DNS 协议进行主机名解析时，系统首先查询本地 DNS 缓存。如果缓存中不存在结果，系统将向本地 DNS 服务器发出请求，并逐级向上查找，直到找到权威 DNS 服务器并获得解析结果。在域名解析的过程中，DNS 协议采用了分级命名空间的结构，不同的域名可以通过点分隔符分为多个级别，例如 `www.example.com` 可以分为三个级别：`www`、`example` 和 `com`。

除了将域名映射到 IP 地址之外，DNS 协议还支持多种其他功能：

1. 逆向映射：将 IP 地址解析为域名。
2. 邮件服务器设置：支持邮件服务器的自动发现和设置。
3. 负载均衡：DNS 还可以实现简单的负载均衡，通过将相同 IP 地址的主机名映射到不同的 IP 地址来分散负载。
4. 安全：DNSSEC（DNS Security Extensions，DNS 安全扩展）可以提供对域名解析的认证和完整性。

 如何加快 DNS 的解析？

有以下几种方法可以加快 DNS 的解析：

1. 使用高速 DNS 服务器：默认情况下，网络服务提供商（ISP）为其用户提供 DNS 服务器。但是，这些服务器不一定是最快的，有时会出现瓶颈。如果您想加快 DNS 解析，请尝试使用其他高速 DNS 服务器，例如 Google 的公共 DNS 服务器或 OpenDNS。

2. 缓存 DNS 记录：在本地计算机上缓存 DNS 记录可以大大加快应用程序的响应。当您访问特定的网站时，计算机会自动缓存该网站的 DNS 记录。如果您再次访问该网站，则计算机将使用缓存的 DNS 记录。

3. 减少 DNS 查找：当您访问一个网站时，您的计算机将会查找该域名的 IP 地址。如果网站有很多域名，则查找过程可能会变得非常缓慢。因此，尽可能使用较少的域名可以减少 DNS 查找的数量，并提高响应速度。

4. 使用 CDN：CDN（内容分发网络）是一种将内容存储在全球多个位置的系统。这些位置通常都有专用的 DNS 服务器，可以大大加快站点的加载速度。

5. 使用 DNS 缓存工具：一些辅助工具可以帮助您优化与 DNS 相关的设置，例如免费的 DNS Jumper 软件和 Namebench 工具，它们可以测试您的 DNS 响应时间并为您推荐最佳配置。

通过使用高速 DNS 服务器、缓存 DNS 记录、减少 DNS 查找、使用 CDN 和 DNS 缓存工具等方法，可以显著提高 DNS 解析速度，从而加快应用程序响应时间。

## DNS 解析方式 {#p0-dns}

1. 浏览器缓存
2. 操作系统缓存
3. 本地 hosts 文件
4. 本地 DNS 服务器
5. 根 DNS 服务器
6. 顶级域名服务器
7. 权威 DNS 服务器

DNS（Domain Name System，域名系统）解析是将域名转换为对应的IP地址的过程。下面是DNS解析的一般步骤：

1. 用户输入域名：用户在浏览器或其他应用程序中输入要访问的域名，例如 "[www.example.com"。](http://www.example.com%22%E3%80%82)

2. 本地缓存查找：操作系统首先会检查本地的DNS缓存，看是否已经缓存了该域名的IP地址。如果有匹配的缓存记录，且仍在有效期内，将直接返回对应的IP地址。

3. 本地域名服务器查询：如果本地缓存中没有找到对应的IP地址，操作系统会向配置的本地域名服务器（通常由ISP提供）发送查询请求。本地域名服务器是存储了大量DNS记录的服务器，通常可以快速响应查询请求。

4. 递归查询或迭代查询：本地域名服务器接收到查询请求后，会根据自身的配置进行递归查询或迭代查询。

递归查询：本地域名服务器会代表客户端进行完整的查询过程，直到找到目标域名的IP地址。如果本地域名服务器已经缓存了目标域名的IP地址，它将直接返回结果给客户端。

迭代查询：本地域名服务器向根域名服务器发送查询请求，根域名服务器返回顶级域名服务器（TLD）的地址。然后本地域名服务器再向TLD发送查询请求，TLD返回该域名的授权域名服务器的地址。最后，本地域名服务器向授权域名服务器发送查询请求，授权域名服务器返回目标域名的IP地址。

5. 返回IP地址：经过递归或迭代查询后，本地域名服务器会将获取到的IP地址返回给操作系统，然后操作系统将该IP地址存储在本地DNS缓存中，并将IP地址传递给应用程序。

6. 应用程序访问目标IP地址：应用程序收到IP地址后，可以直接使用该IP地址与目标服务器建立连接，并进行相应的网络请求。

DNS解析过程中还涉及到DNS记录的缓存、DNS服务器层级结构、域名的分级管理等概念和机制，以保证高效的解析过程和互联网的正常运行。

## 完整域名的构成部分

**一、顶级域名（Top-Level Domain，TLD）**

1. **含义**：

* 顶级域名是域名中最右边的部分，它表示域名的类型或所属的国家或地区。例如，在“example.com”中，“.com”就是顶级域名。
* 顶级域名分为通用顶级域名（gTLD）和国家代码顶级域名（ccTLD）。通用顶级域名如“.com”（商业机构）、“.org”（非营利组织）、“.net”（网络服务机构）等；国家代码顶级域名如“.cn”（中国）、“.uk”（英国）、“.jp”（日本）等。

2. **作用**：

* 顶级域名帮助用户快速识别域名的类型或所属地区，同时也在互联网的命名体系中起到分类和标识的作用。

**二、二级域名（Second-Level Domain，SLD）**

1. **含义**：

* 二级域名位于顶级域名的左边，是域名中的主要标识部分。例如，在“example.com”中，“example”就是二级域名。
* 二级域名通常由网站所有者或组织自行定义，可以是任何符合域名命名规则的字符串。

2. **作用**：

* 二级域名用于区分不同的网站、组织或服务。它是网站的主要标识，用户通过二级域名来识别和访问特定的网站。

**三、子域名（Subdomain）**

1. **含义**：

* 子域名是位于二级域名前面的部分，它可以进一步细分域名的层次结构。例如，在“blog.example.com”中，“blog”就是子域名。
* 子域名可以有多个层次，例如“sub1.sub2.example.com”。

2. **作用**：

* 子域名可以用于划分不同的业务模块、部门或功能区域。例如，一个公司可以使用“blog”子域名来表示其博客站点，使用“shop”子域名来表示其电子商务站点。

**四、协议部分（如 http:// 或 https://）**

1. **含义**：

* 协议部分位于域名的前面，用于指定访问网站所使用的通信协议。常见的协议有“http://”（超文本传输协议）和“https://”（安全超文本传输协议）。

2. **作用**：

* 协议部分决定了浏览器与服务器之间的通信方式和安全性。“https://”协议提供了加密和安全的通信，保护用户数据的安全。

## 什么是DNS劫持？{#p3-dns-catch}

DNS 劫持（DNS Hijacking），也称为 DNS 重定向，是一种通过篡改原本的 DNS 解析流程，使得用户在尝试访问特定网址时被非法重定向到其他（通常是恶意的、广告相关的或者钓鱼的）网站的行为。这种攻击可以发生在用户的个人电脑、网络设备、甚至是直接在 DNS 服务器上。

DNS 劫持可以通过以下几种方式实现：

1. **恶意软件**：

* 用户的计算机被感染了恶意软件，该软件修改了本地的 DNS 设置，例如更改本地的 `hosts` 文件或 DNS 配置，使得所有或特定域名的请求都会被发送到攻击者指定的服务器。

2. **篡改路由器设置**：

* 攻击者通过各种手段（如默认密码、漏洞利用等）获取路由器的管理权限，并修改其上的 DNS 服务器设置，使得连接到该路由器的所有设备的 DNS 请求都会被重定向。

3. **DNS 服务器劫持**：

* 攻击者直接对 DNS 服务器进行攻击，将规范域名的正确解析地址更改为恶意地址。

4. **中间人攻击（Man-in-the-Middle Attack, MiTM）**：

* 在用户与 DNS 服务器之间截获和修改 DNS 查询和响应，将用户请求重定向到另一个服务器。

5. **网络服务提供商干预**：

* 部分网络服务商出于广告和监管的目的，可能会在 DNS 层面上进行重定向，将无效域名或特定关键字的域名请求导向他们自己的服务器。

DNS 劫持对用户的主要威胁是隐私泄露和安全风险，用户有可能无意中访问到含有恶意软件的网页，导致个人信息泄露或者计算机安全受到威胁。为了防范 DNS 劫持，用户可以采取以下措施：

* 使用可信赖的 DNS 服务，如 Google 的 8.8.8.8、Cloudflare 的 1.1.1.1 等。
* 保持操作系统和防病毒软件都更新至最新状态， regularly scan for malware。
* 对家用路由器设置复杂的登录密码，并定期进行固件更新。
* 使用 VPN 服务，在密封的隧道中完成所有网络通信。
* 对于重要的网站，最好使用书签直接访问，防止输入错误的 URL。
* 启用 DNSSEC（Domain Name System Security Extensions），增加额外的验证步骤来保证 DNS 查询的安全。
